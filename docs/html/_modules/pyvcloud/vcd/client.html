
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pyvcloud.vcd.client &#8212; Pyvcloud  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyvcloud.vcd.client</h1><div class="highlight"><pre>
<span></span><span class="c1"># VMware vCloud Director Python SDK</span>
<span class="c1"># Copyright (c) 2017-2018 VMware, Inc. All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<span class="kn">from</span> <span class="nn">flufl.enum</span> <span class="k">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="k">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="k">import</span> <span class="n">objectify</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">SIZE_1MB</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

<span class="n">NSMAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ovf&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://schemas.dmtf.org/ovf/envelope/1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ovfenv&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://schemas.dmtf.org/ovf/environment/1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rasd&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://schemas.dmtf.org/wbem/wscim/1/cim-schema/&#39;</span>
    <span class="s1">&#39;2/CIM_ResourceAllocationSettingData&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vcloud&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://www.vmware.com/vcloud/v1.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ve&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://www.vmware.com/schema/ovfenv&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vmw&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://www.vmware.com/schema/ovf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vmext&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://www.vmware.com/vcloud/extension/v1.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;xs&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://www.w3.org/2001/XMLSchema&#39;</span><span class="p">,</span>
    <span class="s1">&#39;xsi&#39;</span><span class="p">:</span>
    <span class="s1">&#39;http://www.w3.org/2001/XMLSchema-instance&#39;</span>
<span class="p">}</span>

<span class="c1"># Convenience objects for building vCloud API XML objects</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">objectify</span><span class="o">.</span><span class="n">ElementMaker</span><span class="p">(</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">namespace</span><span class="o">=</span><span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;vcloud&#39;</span><span class="p">],</span>
    <span class="n">nsmap</span><span class="o">=</span><span class="p">{</span>
        <span class="kc">None</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;vcloud&#39;</span><span class="p">],</span>
        <span class="s1">&#39;xsi&#39;</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;xsi&#39;</span><span class="p">],</span>
        <span class="s1">&#39;xs&#39;</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;xs&#39;</span><span class="p">],</span>
        <span class="s1">&#39;ovf&#39;</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;ovf&#39;</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">E_VMEXT</span> <span class="o">=</span> <span class="n">objectify</span><span class="o">.</span><span class="n">ElementMaker</span><span class="p">(</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">namespace</span><span class="o">=</span><span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;vmext&#39;</span><span class="p">],</span>
    <span class="n">nsmap</span><span class="o">=</span><span class="p">{</span>
        <span class="kc">None</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;vcloud&#39;</span><span class="p">],</span>
        <span class="s1">&#39;vmext&#39;</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;vmext&#39;</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">E_OVF</span> <span class="o">=</span> <span class="n">objectify</span><span class="o">.</span><span class="n">ElementMaker</span><span class="p">(</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;ovf&#39;</span><span class="p">],</span> <span class="n">nsmap</span><span class="o">=</span><span class="p">{</span>
        <span class="kc">None</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;ovf&#39;</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">E_RASD</span> <span class="o">=</span> <span class="n">objectify</span><span class="o">.</span><span class="n">ElementMaker</span><span class="p">(</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">namespace</span><span class="o">=</span><span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;rasd&#39;</span><span class="p">],</span>
    <span class="n">nsmap</span><span class="o">=</span><span class="p">{</span>
        <span class="kc">None</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;rasd&#39;</span><span class="p">],</span>
        <span class="s1">&#39;vcloud&#39;</span><span class="p">:</span> <span class="n">NSMAP</span><span class="p">[</span><span class="s1">&#39;vcloud&#39;</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">RESOURCE_TYPES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;aclRule&#39;</span><span class="p">,</span> <span class="s1">&#39;adminApiDefinition&#39;</span><span class="p">,</span> <span class="s1">&#39;adminAllocatedExternalAddress&#39;</span><span class="p">,</span>
    <span class="s1">&#39;adminCatalog&#39;</span><span class="p">,</span> <span class="s1">&#39;adminCatalogItem&#39;</span><span class="p">,</span> <span class="s1">&#39;adminDisk&#39;</span><span class="p">,</span> <span class="s1">&#39;adminEvent&#39;</span><span class="p">,</span>
    <span class="s1">&#39;adminFileDescriptor&#39;</span><span class="p">,</span> <span class="s1">&#39;adminGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;adminMedia&#39;</span><span class="p">,</span> <span class="s1">&#39;adminOrgNetwork&#39;</span><span class="p">,</span>
    <span class="s1">&#39;adminOrgVdc&#39;</span><span class="p">,</span> <span class="s1">&#39;adminOrgVdcStorageProfile&#39;</span><span class="p">,</span> <span class="s1">&#39;adminRole&#39;</span><span class="p">,</span> <span class="s1">&#39;adminService&#39;</span><span class="p">,</span>
    <span class="s1">&#39;adminShadowVM&#39;</span><span class="p">,</span> <span class="s1">&#39;adminTask&#39;</span><span class="p">,</span> <span class="s1">&#39;adminUser&#39;</span><span class="p">,</span> <span class="s1">&#39;adminVApp&#39;</span><span class="p">,</span> <span class="s1">&#39;adminVAppNetwork&#39;</span><span class="p">,</span>
    <span class="s1">&#39;adminVAppTemplate&#39;</span><span class="p">,</span> <span class="s1">&#39;adminVM&#39;</span><span class="p">,</span> <span class="s1">&#39;adminVMDiskRelation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;allocatedExternalAddress&#39;</span><span class="p">,</span> <span class="s1">&#39;apiDefinition&#39;</span><span class="p">,</span> <span class="s1">&#39;apiFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;blockingTask&#39;</span><span class="p">,</span>
    <span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;catalogItem&#39;</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">,</span> <span class="s1">&#39;datastore&#39;</span><span class="p">,</span>
    <span class="s1">&#39;datastoreProviderVdcRelation&#39;</span><span class="p">,</span> <span class="s1">&#39;disk&#39;</span><span class="p">,</span> <span class="s1">&#39;dvSwitch&#39;</span><span class="p">,</span> <span class="s1">&#39;edgeGateway&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">,</span>
    <span class="s1">&#39;externalLocalization&#39;</span><span class="p">,</span> <span class="s1">&#39;externalNetwork&#39;</span><span class="p">,</span> <span class="s1">&#39;fileDescriptor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fromCloudTunnel&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;media&#39;</span><span class="p">,</span> <span class="s1">&#39;networkPool&#39;</span><span class="p">,</span> <span class="s1">&#39;organization&#39;</span><span class="p">,</span>
    <span class="s1">&#39;orgNetwork&#39;</span><span class="p">,</span> <span class="s1">&#39;orgVdc&#39;</span><span class="p">,</span> <span class="s1">&#39;orgVdcNetwork&#39;</span><span class="p">,</span> <span class="s1">&#39;orgVdcResourcePoolRelation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;orgVdcStorageProfile&#39;</span><span class="p">,</span> <span class="s1">&#39;portGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;providerVdc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;providerVdcResourcePoolRelation&#39;</span><span class="p">,</span> <span class="s1">&#39;providerVdcStorageProfile&#39;</span><span class="p">,</span>
    <span class="s1">&#39;resourcePool&#39;</span><span class="p">,</span> <span class="s1">&#39;resourcePoolVmList&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;resourceClass&#39;</span><span class="p">,</span>
    <span class="s1">&#39;resourceClassAction&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">,</span> <span class="s1">&#39;service&#39;</span><span class="p">,</span> <span class="s1">&#39;serviceLink&#39;</span><span class="p">,</span> <span class="s1">&#39;serviceResource&#39;</span><span class="p">,</span>
    <span class="s1">&#39;strandedItem&#39;</span><span class="p">,</span> <span class="s1">&#39;strandedUser&#39;</span><span class="p">,</span> <span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="s1">&#39;toCloudTunnel&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;vApp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vAppNetwork&#39;</span><span class="p">,</span> <span class="s1">&#39;vAppOrgVdcNetworkRelation&#39;</span><span class="p">,</span> <span class="s1">&#39;vAppTemplate&#39;</span><span class="p">,</span>
    <span class="s1">&#39;virtualCenter&#39;</span><span class="p">,</span> <span class="s1">&#39;vm&#39;</span><span class="p">,</span> <span class="s1">&#39;vmDiskRelation&#39;</span><span class="p">,</span> <span class="s1">&#39;vmGroups&#39;</span><span class="p">,</span> <span class="s1">&#39;vmGroupVms&#39;</span>
<span class="p">]</span>

<span class="n">API_CURRENT_VERSIONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;5.5&#39;</span><span class="p">,</span> <span class="s1">&#39;5.6&#39;</span><span class="p">,</span> <span class="s1">&#39;6.0&#39;</span><span class="p">,</span> <span class="s1">&#39;13.0&#39;</span><span class="p">,</span> <span class="s1">&#39;17.0&#39;</span><span class="p">,</span> <span class="s1">&#39;20.0&#39;</span><span class="p">,</span> <span class="s1">&#39;21.0&#39;</span><span class="p">,</span> <span class="s1">&#39;22.0&#39;</span><span class="p">,</span> <span class="s1">&#39;23.0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;24.0&#39;</span><span class="p">,</span> <span class="s1">&#39;25.0&#39;</span><span class="p">,</span> <span class="s1">&#39;26.0&#39;</span><span class="p">,</span> <span class="s1">&#39;27.0&#39;</span><span class="p">,</span> <span class="s1">&#39;28.0&#39;</span><span class="p">,</span> <span class="s1">&#39;29.0&#39;</span><span class="p">,</span> <span class="s1">&#39;30.0&#39;</span>
<span class="p">]</span>

<span class="n">VCLOUD_STATUS_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Could not be created&quot;</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;Unresolved&quot;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Resolved&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Deployed&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;Suspended&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Powered on&quot;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Waiting for user input&quot;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;Unknown state&quot;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;Unrecognized state&quot;</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;Powered off&quot;</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;Inconsistent state&quot;</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s2">&quot;Children do not all have the same status&quot;</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="s2">&quot;Upload initiated, OVF descriptor pending&quot;</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;Upload initiated, copying contents&quot;</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="s2">&quot;Upload initiated , disk contents pending&quot;</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="s2">&quot;Upload has been quarantined&quot;</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="s2">&quot;Upload quarantine period has expired&quot;</span>
<span class="p">}</span>


<div class="viewcode-block" id="BasicLoginCredentials"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.BasicLoginCredentials">[docs]</a><span class="k">class</span> <span class="nc">BasicLoginCredentials</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">org</span> <span class="o">=</span> <span class="n">org</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>


<div class="viewcode-block" id="RelationType"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.RelationType">[docs]</a><span class="k">class</span> <span class="nc">RelationType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ADD</span> <span class="o">=</span> <span class="s1">&#39;add&#39;</span>
    <span class="n">ALTERNATE</span> <span class="o">=</span> <span class="s1">&#39;alternate&#39;</span>
    <span class="n">CONTROL_ACCESS</span> <span class="o">=</span> <span class="s1">&#39;controlAccess&#39;</span>
    <span class="n">DEPLOY</span> <span class="o">=</span> <span class="s1">&#39;deploy&#39;</span>
    <span class="n">DISABLE</span> <span class="o">=</span> <span class="s1">&#39;disable&#39;</span>
    <span class="n">DISK_ATTACH</span> <span class="o">=</span> <span class="s1">&#39;disk:attach&#39;</span>
    <span class="n">DISK_DETACH</span> <span class="o">=</span> <span class="s1">&#39;disk:detach&#39;</span>
    <span class="n">DOWN</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
    <span class="n">DOWN_EXTENSIBILITY</span> <span class="o">=</span> <span class="s1">&#39;down:extensibility&#39;</span>
    <span class="n">DOWNLOAD_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;download:default&#39;</span>
    <span class="n">EDGE_GATEWAYS</span> <span class="o">=</span> <span class="s1">&#39;edgeGateways&#39;</span>
    <span class="n">EDIT</span> <span class="o">=</span> <span class="s1">&#39;edit&#39;</span>
    <span class="n">ENABLE</span> <span class="o">=</span> <span class="s1">&#39;enable&#39;</span>
    <span class="n">LINK_TO_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;linkToTemplate&#39;</span>
    <span class="n">NEXT_PAGE</span> <span class="o">=</span> <span class="s1">&#39;nextPage&#39;</span>
    <span class="n">ORG_VDC_NETWORKS</span> <span class="o">=</span> <span class="s1">&#39;orgVdcNetworks&#39;</span>
    <span class="n">POWER_OFF</span> <span class="o">=</span> <span class="s1">&#39;power:powerOff&#39;</span>
    <span class="n">POWER_ON</span> <span class="o">=</span> <span class="s1">&#39;power:powerOn&#39;</span>
    <span class="n">POWER_REBOOT</span> <span class="o">=</span> <span class="s1">&#39;power:reboot&#39;</span>
    <span class="n">POWER_RESET</span> <span class="o">=</span> <span class="s1">&#39;power:reset&#39;</span>
    <span class="n">POWER_SHUTDOWN</span> <span class="o">=</span> <span class="s1">&#39;power:shutdown&#39;</span>
    <span class="n">POWER_SUSPEND</span> <span class="o">=</span> <span class="s1">&#39;power:suspend&#39;</span>
    <span class="n">RECOMPOSE</span> <span class="o">=</span> <span class="s1">&#39;recompose&#39;</span>
    <span class="n">REMOVE</span> <span class="o">=</span> <span class="s1">&#39;remove&#39;</span>
    <span class="n">SNAPSHOT_CREATE</span> <span class="o">=</span> <span class="s1">&#39;snapshot:create&#39;</span>
    <span class="n">SNAPSHOT_REVERT_TO_CURRENT</span> <span class="o">=</span> <span class="s1">&#39;snapshot:revertToCurrent&#39;</span>
    <span class="n">SNAPSHOT_REMOVE_ALL</span> <span class="o">=</span> <span class="s1">&#39;snapshot:removeAll&#39;</span>
    <span class="n">TASK_CANCEL</span> <span class="o">=</span> <span class="s1">&#39;task:cancel&#39;</span>
    <span class="n">UNDEPLOY</span> <span class="o">=</span> <span class="s1">&#39;undeploy&#39;</span>
    <span class="n">UNLINK_FROM_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;unlinkFromTemplate&#39;</span></div>
    <span class="n">UP</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>


<div class="viewcode-block" id="EntityType"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.EntityType">[docs]</a><span class="k">class</span> <span class="nc">EntityType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ADMIN</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.vcloud+xml&#39;</span>
    <span class="n">ADMIN_CATALOG</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.catalog+xml&#39;</span>
    <span class="n">ADMIN_ORG</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.organization+xml&#39;</span>
    <span class="n">ADMIN_SERVICE</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.service+xml&#39;</span>
    <span class="n">API_EXTENSIBILITY</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.apiextensibility+xml&#39;</span>
    <span class="n">AMQP_SETTINGS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.amqpSettings+xml&#39;</span>
    <span class="n">CATALOG</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.catalog+xml&#39;</span>
    <span class="n">CAPTURE_VAPP_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.captureVAppParams+xml&#39;</span>
    <span class="n">COMPOSE_VAPP_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.composeVAppParams+xml&#39;</span>
    <span class="n">CONTROL_ACCESS_PARAMS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.controlAccess+xml&#39;</span>
    <span class="n">DEPLOY</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.deployVAppParams+xml&#39;</span>
    <span class="n">DISK</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.disk+xml&#39;</span>
    <span class="n">DISK_ATTACH_DETACH_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.diskAttachOrDetachParams+xml&#39;</span>
    <span class="n">DISK_CREATE_PARMS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.diskCreateParams+xml&#39;</span>
    <span class="n">EDGE_GATEWAY</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.edgeGateway+xml&#39;</span>
    <span class="n">EDGE_GATEWAY_SERVICE_CONFIGURATION</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.admin.edgeGatewayServiceConfiguration+xml&#39;</span>
    <span class="n">EXTENSION</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.vmwExtension+xml&#39;</span>
    <span class="n">EXTENSION_SERVICES</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.extensionServices+xml&#39;</span>
    <span class="n">EXTERNAL_NETWORK_REFS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.admin.vmwExternalNetworkReferences+xml&#39;</span>
    <span class="n">INSTANTIATE_VAPP_TEMPLATE_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.instantiateVAppTemplateParams+xml&#39;</span>
    <span class="n">LEASE_SETTINGS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.leaseSettingsSection+xml&#39;</span>
    <span class="n">MEDIA</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.media+xml&#39;</span>
    <span class="n">METADATA</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.metadata+xml&#39;</span>
    <span class="n">NETWORK_CONFIG_SECTION</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.networkConfigSection+xml&#39;</span>
    <span class="n">NETWORK_CONNECTION_SECTION</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.networkConnectionSection+xml&#39;</span>
    <span class="n">NETWORK_POOL_REFERENCES</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.admin.vmwNetworkPoolReferences+xml&#39;</span>
    <span class="n">ORG</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.org+xml&#39;</span>
    <span class="n">ORG_NETWORK</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.orgNetwork+xml&#39;</span>
    <span class="n">ORG_LIST</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.orgList+xml&#39;</span>
    <span class="n">ORG_RIGHTS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.org.rights+xml&#39;</span>
    <span class="n">ORG_VDC_NETWORK</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.orgVdcNetwork+xml&#39;</span>
    <span class="n">OWNER</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.owner+xml&#39;</span>
    <span class="n">PROVIDER_VDC_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.admin.createProviderVdcParams+xml&#39;</span>
    <span class="n">PUBLISH_CATALOG_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.admin.publishCatalogParams+xml&#39;</span>
    <span class="n">QUERY_LIST</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.query.queryList+xml&#39;</span>
    <span class="n">RASD_ITEM</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.rasdItem+xml&#39;</span>
    <span class="n">RASD_ITEMS_LIST</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.rasdItemsList+xml&#39;</span>
    <span class="n">RECOMPOSE_VAPP_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.recomposeVAppParams+xml&#39;</span>
    <span class="n">RECORDS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.query.records+xml&#39;</span>
    <span class="n">REGISTER_VC_SERVER_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.admin.registerVimServerParams+xml&#39;</span>
    <span class="n">ROLE</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.role+xml&#39;</span>
    <span class="n">RIGHT</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.right+xml&#39;</span>
    <span class="n">SNAPSHOT_CREATE</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.createSnapshotParams+xml&#39;</span>
    <span class="n">SYSTEM_SETTINGS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.systemSettings+xml&#39;</span>
    <span class="n">TASK</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.task+xml&#39;</span>
    <span class="n">TASKS_LIST</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.tasksList+xml&#39;</span>
    <span class="n">TEXT_XML</span> <span class="o">=</span> <span class="s1">&#39;text/xml&#39;</span>
    <span class="n">UNDEPLOY</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.undeployVAppParams+xml&#39;</span>
    <span class="n">UPLOAD_VAPP_TEMPLATE_PARAMS</span> <span class="o">=</span> \
        <span class="s1">&#39;application/vnd.vmware.vcloud.uploadVAppTemplateParams+xml&#39;</span>
    <span class="n">USER</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.user+xml&#39;</span>
    <span class="n">VAPP</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.vApp+xml&#39;</span>
    <span class="n">VAPP_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.vAppTemplate+xml&#39;</span>
    <span class="n">VDC</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.vdc+xml&#39;</span>
    <span class="n">VDC_REFERENCES</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.vdcReferences+xml&#39;</span>
    <span class="n">VDCS_PARAMS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.createVdcParams+xml&#39;</span>
    <span class="n">VIM_SERVER_REFS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.admin.vmwVimServerReferences+xml&#39;</span></div>
    <span class="n">VMS</span> <span class="o">=</span> <span class="s1">&#39;application/vnd.vmware.vcloud.vms+xml&#39;</span>


<div class="viewcode-block" id="QueryResultFormat"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.QueryResultFormat">[docs]</a><span class="k">class</span> <span class="nc">QueryResultFormat</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RECORDS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;application/vnd.vmware.vcloud.query.records+xml&#39;</span><span class="p">,</span> <span class="s1">&#39;records&#39;</span><span class="p">)</span>
    <span class="n">ID_RECORDS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;application/vnd.vmware.vcloud.query.idrecords+xml&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;idrecords&#39;</span><span class="p">)</span>
    <span class="n">REFERENCES</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;application/vnd.vmware.vcloud.query.references+xml&#39;</span><span class="p">,</span></div>
                  <span class="s1">&#39;references&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_WellKnownEndpoint</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">LOGGED_IN_ORG</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">ORG</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ORG_VDC</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">VDC</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ORG_NETWORK</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">ORG_NETWORK</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ORG_CATALOG</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">CATALOG</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">QUERY_LIST</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">QUERY_LIST</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ADMIN</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">ADMIN</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">API_EXTENSIBILITY</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN_EXTENSIBILITY</span><span class="p">,</span>
                         <span class="n">EntityType</span><span class="o">.</span><span class="n">API_EXTENSIBILITY</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">EXTENSION</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">EXTENSION</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ORG_LIST</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">EntityType</span><span class="o">.</span><span class="n">ORG_LIST</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">SNAPSHOT_CREATE</span> <span class="o">=</span> <span class="p">(</span><span class="n">RelationType</span><span class="o">.</span><span class="n">SNAPSHOT_CREATE</span><span class="p">,</span>
                       <span class="n">EntityType</span><span class="o">.</span><span class="n">SNAPSHOT_CREATE</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<div class="viewcode-block" id="FenceMode"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.FenceMode">[docs]</a><span class="k">class</span> <span class="nc">FenceMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ISOLATED</span> <span class="o">=</span> <span class="s1">&#39;isolated&#39;</span>
    <span class="n">DIRECT</span> <span class="o">=</span> <span class="s1">&#39;direct&#39;</span>
    <span class="n">BRIDGED</span> <span class="o">=</span> <span class="s1">&#39;bridged&#39;</span></div>
    <span class="n">NAT_ROUTED</span> <span class="o">=</span> <span class="s1">&#39;natRouted&#39;</span>


<div class="viewcode-block" id="MultipleRecordsException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.MultipleRecordsException">[docs]</a><span class="k">class</span> <span class="nc">MultipleRecordsException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span></div>
    <span class="k">pass</span>


<div class="viewcode-block" id="MissingRecordException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.MissingRecordException">[docs]</a><span class="k">class</span> <span class="nc">MissingRecordException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span></div>
    <span class="k">pass</span>


<div class="viewcode-block" id="LinkException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.LinkException">[docs]</a><span class="k">class</span> <span class="nc">LinkException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">href</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel</span> <span class="o">=</span> <span class="n">rel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">media_type</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">; href: </span><span class="si">%s</span><span class="s1">, rel: </span><span class="si">%s</span><span class="s1">, mediaType: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">LinkException</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">href</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">rel</span><span class="p">,</span></div>
             <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>


<div class="viewcode-block" id="MultipleLinksException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.MultipleLinksException">[docs]</a><span class="k">class</span> <span class="nc">MultipleLinksException</span><span class="p">(</span><span class="n">LinkException</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">):</span></div>
        <span class="nb">super</span><span class="p">(</span><span class="n">MultipleLinksException</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">href</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>


<div class="viewcode-block" id="MissingLinkException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.MissingLinkException">[docs]</a><span class="k">class</span> <span class="nc">MissingLinkException</span><span class="p">(</span><span class="n">LinkException</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">href</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">):</span></div>
        <span class="nb">super</span><span class="p">(</span><span class="n">MissingLinkException</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">href</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>


<div class="viewcode-block" id="VcdErrorException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.VcdErrorException">[docs]</a><span class="k">class</span> <span class="nc">VcdErrorException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">):</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="n">status_code</span>


<div class="viewcode-block" id="VcdErrorResponseException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.VcdErrorResponseException">[docs]</a><span class="k">class</span> <span class="nc">VcdErrorResponseException</span><span class="p">(</span><span class="n">VcdErrorException</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">vcd_error</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VcdErrorResponseException</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span> <span class="o">=</span> <span class="n">vcd_error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="s1">&#39;Status code: &#39;</span> <span class="o">+</span> \
            <span class="p">((</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">, &lt;empty response body&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span>
                <span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minorErrorCode&#39;</span><span class="p">),</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">))))</span> <span class="o">+</span> \</div>
            <span class="p">(</span><span class="s1">&#39; (request id: </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span>


<div class="viewcode-block" id="VcdTaskException"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.VcdTaskException">[docs]</a><span class="k">class</span> <span class="nc">VcdTaskException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_message</span><span class="p">,</span> <span class="n">vcd_error</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">=</span> <span class="n">error_message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span> <span class="o">=</span> <span class="n">vcd_error</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> \
            <span class="s1">&#39;VcdTaskException; </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;majorErrorCode&#39;</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minorErrorCode&#39;</span><span class="p">),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">error_message</span><span class="p">,</span></div>
             <span class="bp">self</span><span class="o">.</span><span class="n">vcd_error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_get_session_endpoints</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a map of well known endpoings.</span>

<span class="sd">    Build and return a map keyed by well-known endpoints, yielding hrefs,</span>
<span class="sd">        from a &lt;Session&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">smap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">_WellKnownEndpoint</span><span class="p">:</span>
        <span class="p">(</span><span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">value</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">find_link</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">smap</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">href</span>
    <span class="k">return</span> <span class="n">smap</span>


<span class="k">def</span> <span class="nf">_response_has_content</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">_objectify_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">as_object</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_response_has_content</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">as_object</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">objectify</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>


<div class="viewcode-block" id="TaskStatus"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.TaskStatus">[docs]</a><span class="k">class</span> <span class="nc">TaskStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">QUEUED</span> <span class="o">=</span> <span class="s1">&#39;queued&#39;</span>
    <span class="n">PRE_RUNNING</span> <span class="o">=</span> <span class="s1">&#39;preRunning&#39;</span>
    <span class="n">RUNNING</span> <span class="o">=</span> <span class="s1">&#39;running&#39;</span>
    <span class="n">SUCCESS</span> <span class="o">=</span> <span class="s1">&#39;success&#39;</span>
    <span class="n">ERROR</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>
    <span class="n">CANCELED</span> <span class="o">=</span> <span class="s1">&#39;canceled&#39;</span></div>
    <span class="n">ABORTED</span> <span class="o">=</span> <span class="s1">&#39;aborted&#39;</span>


<span class="k">class</span> <span class="nc">_TaskMonitor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_DEFAULT_POLL_SEC</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">_DEFAULT_TIMEOUT_SEC</span> <span class="o">=</span> <span class="mi">600</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>

    <span class="k">def</span> <span class="nf">wait_for_success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">task</span><span class="p">,</span>
                         <span class="n">timeout</span><span class="o">=</span><span class="n">_DEFAULT_TIMEOUT_SEC</span><span class="p">,</span>
                         <span class="n">poll_frequency</span><span class="o">=</span><span class="n">_DEFAULT_POLL_SEC</span><span class="p">,</span>
                         <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_status</span><span class="p">(</span>
            <span class="n">task</span><span class="p">,</span>
            <span class="n">timeout</span><span class="p">,</span>
            <span class="n">poll_frequency</span><span class="p">,</span> <span class="p">[</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">ERROR</span><span class="p">],</span> <span class="p">[</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wait_for_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">task</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="n">_DEFAULT_TIMEOUT_SEC</span><span class="p">,</span>
                        <span class="n">poll_frequency</span><span class="o">=</span><span class="n">_DEFAULT_POLL_SEC</span><span class="p">,</span>
                        <span class="n">fail_on_statuses</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">TaskStatus</span><span class="o">.</span><span class="n">ABORTED</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="o">.</span><span class="n">CANCELED</span><span class="p">,</span>
                            <span class="n">TaskStatus</span><span class="o">.</span><span class="n">ERROR</span>
                        <span class="p">],</span>
                        <span class="n">expected_target_statuses</span><span class="o">=</span><span class="p">[</span><span class="n">TaskStatus</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">],</span>
                        <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Waits for task to reach expected status.</span>

<span class="sd">        :param task: (Task): task returned by post or put calls.</span>
<span class="sd">        :param timeout: (float): time (in seconds, floating point, fractional)</span>
<span class="sd">            to wait for task to finish.</span>
<span class="sd">        :param poll_frequency: (float): time (in seconds, as above) with which</span>
<span class="sd">            task will be polled.</span>
<span class="sd">        :param fail_on_statuses: (list): method will raise an exception if any</span>
<span class="sd">            of the (TaskStatus) in this list is reached. If this parameter is</span>
<span class="sd">            None then either task will achieve expected target status or throw</span>
<span class="sd">            (TimeOutException).</span>
<span class="sd">        :param expected_target_statuses: (list): list of expected target</span>
<span class="sd">            status.</span>
<span class="sd">        :return (Task): from list of expected target status.</span>
<span class="sd">        :throws TimeoutException: (Exception): exception thrown when task is</span>
<span class="sd">            not finished within given time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fail_on_statuses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_fail_on_statuses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fail_on_statuses</span><span class="p">,</span> <span class="n">TaskStatus</span><span class="p">):</span>
            <span class="n">_fail_on_statuses</span><span class="p">[</span><span class="n">fail_on_statuses</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_fail_on_statuses</span> <span class="o">=</span> <span class="n">fail_on_statuses</span>
        <span class="n">task_href</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_task_status</span><span class="p">(</span><span class="n">task_href</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
            <span class="n">task_status</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">expected_target_statuses</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">task_status</span> <span class="o">==</span> <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">task</span>
            <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">_fail_on_statuses</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">task_status</span> <span class="o">==</span> <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">VcdTaskException</span><span class="p">(</span><span class="n">task_status</span><span class="p">,</span> <span class="n">task</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start_time</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">timeout</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_frequency</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Task timeout&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_task_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_href</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">task_href</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_task_status</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<div class="viewcode-block" id="Client"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client">[docs]</a><span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A low-level interface to the vCloud Director REST API.&quot;&quot;&quot;</span>

    <span class="n">_REQUEST_ID_HDR_NAME</span> <span class="o">=</span> <span class="s1">&#39;X-VMWARE-VCLOUD-REQUEST-ID&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">uri</span><span class="p">,</span>
                 <span class="n">api_version</span><span class="o">=</span><span class="s1">&#39;6.0&#39;</span><span class="p">,</span>
                 <span class="n">verify_ssl_certs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">log_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">log_requests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">log_headers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">log_bodies</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">=</span> <span class="n">uri</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uri</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">+=</span> <span class="s1">&#39;api&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">+=</span> <span class="s1">&#39;/api&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                    <span class="s1">&#39;http://&#39;</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">=</span> <span class="s1">&#39;https://&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span> <span class="o">=</span> <span class="n">api_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_endpoints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_list_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task_monitor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verify_ssl_certs</span> <span class="o">=</span> <span class="n">verify_ssl_certs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span> <span class="k">if</span> <span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> \
            <span class="n">logging</span><span class="o">.</span><span class="n">NullHandler</span><span class="p">()</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)-23.23s</span><span class="s1"> | &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">%(levelname)-5.5s</span><span class="s1"> | &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">%(name)-15.15s</span><span class="s1"> | &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">%(module)-15.15s</span><span class="s1"> | &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">%(funcName)-12.12s</span><span class="s1"> | &#39;</span>
                                      <span class="s1">&#39;</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

        <span class="n">requests_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;requests.packages.urllib3&quot;</span><span class="p">)</span>
        <span class="n">requests_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="n">requests_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_requests</span> <span class="o">=</span> <span class="n">log_requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span> <span class="o">=</span> <span class="n">log_headers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span> <span class="o">=</span> <span class="n">log_bodies</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fsencoding</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getfilesystemencoding</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_sysadmin</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_get_response_request_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_REQUEST_ID_HDR_NAME</span><span class="p">]</span>

<div class="viewcode-block" id="Client.get_supported_versions"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_supported_versions">[docs]</a>    <span class="k">def</span> <span class="nf">get_supported_versions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">new_session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request_prim</span><span class="p">(</span>
            <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">+</span> <span class="s1">&#39;/versions&#39;</span><span class="p">,</span> <span class="n">new_session</span><span class="p">,</span> <span class="n">accept_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="n">sc</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unable to get supported API versions.&#39;</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="n">objectify</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<div class="viewcode-block" id="Client.set_highest_supported_version"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.set_highest_supported_version">[docs]</a>    <span class="k">def</span> <span class="nf">set_highest_supported_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_supported_versions</span><span class="p">()</span>
        <span class="n">active_versions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="o">.</span><span class="n">VersionInfo</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="s1">&#39;deprecated&#39;</span><span class="p">)</span> <span class="ow">or</span> \
               <span class="n">version</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deprecated&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
                <span class="n">active_versions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">version</span><span class="o">.</span><span class="n">Version</span><span class="p">))</span>
        <span class="n">active_versions</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span> <span class="o">=</span> <span class="n">active_versions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;API versions supported: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">active_versions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;API version set to highest supported: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span>

<div class="viewcode-block" id="Client.set_credentials"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.set_credentials">[docs]</a>    <span class="k">def</span> <span class="nf">set_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">creds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the credentials used for authentication.&quot;&quot;&quot;</span>
        <span class="n">new_session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request_prim</span><span class="p">(</span>
            <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">+</span> <span class="s1">&#39;/sessions&#39;</span><span class="p">,</span>
            <span class="n">new_session</span><span class="p">,</span>
            <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">@</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">creds</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">creds</span><span class="o">.</span><span class="n">org</span><span class="p">),</span> <span class="n">creds</span><span class="o">.</span><span class="n">password</span><span class="p">))</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="n">sc</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">_objectify_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">raise</span> <span class="n">VcdErrorResponseException</span><span class="p">(</span>
                <span class="n">sc</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_response_request_id</span><span class="p">(</span><span class="n">response</span><span class="p">),</span>
                <span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> \
                <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Login failed.&#39;</span><span class="p">)</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">objectify</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_endpoints</span> <span class="o">=</span> <span class="n">_get_session_endpoints</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">new_session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-vcloud-authorization&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-vcloud-authorization&#39;</span><span class="p">]</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_sysadmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_sys_admin</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="Client.rehydrate"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.rehydrate">[docs]</a>    <span class="k">def</span> <span class="nf">rehydrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-vcloud-authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;token&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_sysadmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_sys_admin</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org&#39;</span><span class="p">))</span>
        <span class="n">wkep</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wkep&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_endpoints</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">_WellKnownEndpoint</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">wkep</span><span class="p">:</span></div>
                <span class="bp">self</span><span class="o">.</span><span class="n">_session_endpoints</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">wkep</span><span class="p">[</span><span class="n">endpoint</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

<div class="viewcode-block" id="Client.rehydrate_from_token"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.rehydrate_from_token">[docs]</a>    <span class="k">def</span> <span class="nf">rehydrate_from_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="n">new_session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">new_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-vcloud-authorization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
        <span class="n">new_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Accept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/*+xml;version=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request_prim</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">+</span> <span class="s2">&quot;/session&quot;</span><span class="p">,</span>
                                         <span class="n">new_session</span><span class="p">)</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
        <span class="k">if</span> <span class="n">sc</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VcdErrorResponseException</span><span class="p">(</span>
                <span class="n">sc</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_response_request_id</span><span class="p">(</span><span class="n">response</span><span class="p">),</span>
                <span class="n">_objectify_response</span><span class="p">(</span><span class="n">response</span><span class="p">))</span> <span class="k">if</span> <span class="n">sc</span> <span class="o">==</span> <span class="mi">401</span> <span class="k">else</span> \
                <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown login failure&quot;</span><span class="p">)</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">objectify</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_sysadmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_sys_admin</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;org&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_endpoints</span> <span class="o">=</span> <span class="n">_get_session_endpoints</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">new_session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-vcloud-authorization&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;x-vcloud-authorization&#39;</span><span class="p">]</span></div>
        <span class="k">return</span> <span class="n">session</span>

<div class="viewcode-block" id="Client.logout"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.logout">[docs]</a>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span> <span class="o">+</span> <span class="s1">&#39;/session&#39;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_sys_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logged_in_org</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">logged_in_org</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;system&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Client.is_sysadmin"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.is_sysadmin">[docs]</a>    <span class="k">def</span> <span class="nf">is_sysadmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_sysadmin</span>

<div class="viewcode-block" id="Client.get_api_uri"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_api_uri">[docs]</a>    <span class="k">def</span> <span class="nf">get_api_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uri</span>

<div class="viewcode-block" id="Client.get_task_monitor"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_task_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_monitor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_task_monitor</span> <span class="o">=</span> <span class="n">_TaskMonitor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_monitor</span>

    <span class="k">def</span> <span class="nf">_do_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">method</span><span class="p">,</span>
                    <span class="n">uri</span><span class="p">,</span>
                    <span class="n">contents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">media_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">accept_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">objectify_results</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request_prim</span><span class="p">(</span>
            <span class="n">method</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">,</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">media_type</span><span class="o">=</span><span class="n">media_type</span><span class="p">)</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>

        <span class="k">if</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="n">sc</span> <span class="o">&lt;=</span> <span class="mi">299</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_objectify_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">objectify_results</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">400</span> <span class="o">&lt;=</span> <span class="n">sc</span> <span class="o">&lt;=</span> <span class="mi">499</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VcdErrorResponseException</span><span class="p">(</span>
                <span class="n">sc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response_request_id</span><span class="p">(</span><span class="n">response</span><span class="p">),</span>
                <span class="n">_objectify_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">objectify_results</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">sc</span> <span class="o">==</span> <span class="mi">500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">VcdErrorResponseException</span><span class="p">(</span>
                <span class="n">sc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response_request_id</span><span class="p">(</span><span class="n">response</span><span class="p">),</span>
                <span class="n">_objectify_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">objectify_results</span><span class="p">))</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported HTTP status code (</span><span class="si">%d</span><span class="s2">) encountered&quot;</span> <span class="o">%</span> <span class="n">sc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_request_prim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">method</span><span class="p">,</span>
                         <span class="n">uri</span><span class="p">,</span>
                         <span class="n">session</span><span class="p">,</span>
                         <span class="n">contents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">media_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">accept_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">auth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">media_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">media_type</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Accept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">;version=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="s1">&#39;application/*+xml&#39;</span> <span class="k">if</span> <span class="n">accept_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">accept_type</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_api_version</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">contents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
            <span class="n">method</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify_ssl_certs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_requests</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request uri (</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">uri</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request headers: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
                                                            <span class="n">headers</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span> <span class="ow">and</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fsencoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request body: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_requests</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;Response status code: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Response headers: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span> <span class="ow">and</span> <span class="n">_response_has_content</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fsencoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Response body: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

<div class="viewcode-block" id="Client.upload_fragment"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.upload_fragment">[docs]</a>    <span class="k">def</span> <span class="nf">upload_fragment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">range_str</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">range_str</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">contents</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
            <span class="s1">&#39;PUT&#39;</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify_ssl_certs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request uri: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request headers: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;Response status code: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Response headers: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span> <span class="ow">and</span> <span class="n">_response_has_content</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Response body: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="n">response</span>

<div class="viewcode-block" id="Client.download_from_uri"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.download_from_uri">[docs]</a>    <span class="k">def</span> <span class="nf">download_from_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">uri</span><span class="p">,</span>
                          <span class="n">file_name</span><span class="p">,</span>
                          <span class="n">chunk_size</span><span class="o">=</span><span class="n">SIZE_1MB</span><span class="p">,</span>
                          <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                          <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
            <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_verify_ssl_certs</span><span class="p">)</span>
        <span class="n">bytes_written</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="n">bytes_written</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">callback</span><span class="p">(</span><span class="n">bytes_written</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_bodies</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Request uri: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">uri</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_headers</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s1">&#39;Response status code: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s1">&#39;Response headers: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="n">bytes_written</span>

<div class="viewcode-block" id="Client.put_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.put_resource">[docs]</a>    <span class="k">def</span> <span class="nf">put_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">objectify_results</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Puts the specified contents to the specified resource.</span>

<span class="sd">        This method does an HTTP PUT.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span>
            <span class="s1">&#39;PUT&#39;</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">media_type</span><span class="o">=</span><span class="n">media_type</span><span class="p">,</span></div>
            <span class="n">objectify_results</span><span class="o">=</span><span class="n">objectify_results</span><span class="p">)</span>

<div class="viewcode-block" id="Client.put_linked_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.put_linked_resource">[docs]</a>    <span class="k">def</span> <span class="nf">put_linked_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Puts to a resource link.</span>

<span class="sd">        Puts the contents of the resource referenced by the link with the</span>
<span class="sd">            specified rel and mediaType in the specified resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">put_resource</span><span class="p">(</span></div>
            <span class="n">find_link</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>

<div class="viewcode-block" id="Client.post_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.post_resource">[docs]</a>    <span class="k">def</span> <span class="nf">post_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">objectify_results</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Posts to a resource link.</span>

<span class="sd">        Posts the specified contents to the specified resource.</span>
<span class="sd">            (Does an HTTP POST.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span>
            <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">media_type</span><span class="o">=</span><span class="n">media_type</span><span class="p">,</span></div>
            <span class="n">objectify_results</span><span class="o">=</span><span class="n">objectify_results</span><span class="p">)</span>

<div class="viewcode-block" id="Client.post_linked_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.post_linked_resource">[docs]</a>    <span class="k">def</span> <span class="nf">post_linked_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">contents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Posts to a resource link.</span>

<span class="sd">        Posts the contents of the resource referenced by the link with the</span>
<span class="sd">            specified rel and mediaType in the specified resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_resource</span><span class="p">(</span></div>
            <span class="n">find_link</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span><span class="o">.</span><span class="n">href</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_resource">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">objectify_results</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the specified contents to the specified resource.</span>

<span class="sd">        This method does an HTTP GET.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span></div>
            <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">objectify_results</span><span class="o">=</span><span class="n">objectify_results</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_linked_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_linked_resource">[docs]</a>    <span class="k">def</span> <span class="nf">get_linked_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the content of the resource link.</span>

<span class="sd">        Gets the contents of the resource referenced by the link with the</span>
<span class="sd">            specified rel and mediaType in the specified resource.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">find_link</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>

<div class="viewcode-block" id="Client.delete_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.delete_resource">[docs]</a>    <span class="k">def</span> <span class="nf">delete_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">full_uri</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">?force=</span><span class="si">%s</span><span class="s1">&amp;recursive=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">force</span><span class="p">,</span> <span class="n">recursive</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_request</span><span class="p">(</span><span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="n">full_uri</span><span class="p">)</span>

<div class="viewcode-block" id="Client.delete_linked_resource"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.delete_linked_resource">[docs]</a>    <span class="k">def</span> <span class="nf">delete_linked_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the resource referenced by the link.</span>

<span class="sd">        Deletes the resource referenced by the link with the specified rel and</span>
<span class="sd">            mediaType in the specified resource.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_resource</span><span class="p">(</span><span class="n">find_link</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_admin"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_admin">[docs]</a>    <span class="k">def</span> <span class="nf">get_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the &quot;admin&quot; root resource type.&quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wk_resource</span><span class="p">(</span><span class="n">_WellKnownEndpoint</span><span class="o">.</span><span class="n">ADMIN</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_query_list"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_query_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_query_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of supported queries.&quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wk_resource</span><span class="p">(</span><span class="n">_WellKnownEndpoint</span><span class="o">.</span><span class="n">QUERY_LIST</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_org"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_org">[docs]</a>    <span class="k">def</span> <span class="nf">get_org</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the logged in org.&quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wk_resource</span><span class="p">(</span><span class="n">_WellKnownEndpoint</span><span class="o">.</span><span class="n">LOGGED_IN_ORG</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_extensibility"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_extensibility">[docs]</a>    <span class="k">def</span> <span class="nf">get_extensibility</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the &#39;extensibility&#39; resource type.&quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wk_resource</span><span class="p">(</span><span class="n">_WellKnownEndpoint</span><span class="o">.</span><span class="n">API_EXTENSIBILITY</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_extension"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_extension">[docs]</a>    <span class="k">def</span> <span class="nf">get_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the &#39;extension&#39; resource type.&quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wk_resource</span><span class="p">(</span><span class="n">_WellKnownEndpoint</span><span class="o">.</span><span class="n">EXTENSION</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_org_list"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_org_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_org_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of organizationsself.&quot;&quot;&quot;</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_wk_resource</span><span class="p">(</span><span class="n">_WellKnownEndpoint</span><span class="o">.</span><span class="n">ORG_LIST</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_org_by_name"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_org_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_org_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">org_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve an organization.</span>

<span class="sd">        :param org_name: name of the org to be retrieved.</span>
<span class="sd">        :return: Org record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_org_list</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">orgs</span><span class="p">,</span> <span class="s1">&#39;Org&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">org</span> <span class="ow">in</span> <span class="n">orgs</span><span class="o">.</span><span class="n">Org</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">org</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">org_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">org</span></div>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;org </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="n">org_name</span><span class="p">)</span>

<div class="viewcode-block" id="Client.get_user_in_org"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_user_in_org">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_in_org</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_name</span><span class="p">,</span> <span class="n">org_href</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve user from a particular org.</span>

<span class="sd">        :param user_name: user name to be retrieved.</span>
<span class="sd">        :param org_href: org where the user belongs.</span>

<span class="sd">        :return:  A :class:`lxml.objectify.StringElement` object</span>
<span class="sd">            representing the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource_type</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
        <span class="n">org_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_sysadmin</span><span class="p">():</span>
            <span class="n">resource_type</span> <span class="o">=</span> <span class="s1">&#39;adminUser&#39;</span>
            <span class="n">org_filter</span> <span class="o">=</span> <span class="s1">&#39;org==</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">org_href</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typed_query</span><span class="p">(</span>
            <span class="n">resource_type</span><span class="p">,</span>
            <span class="n">query_result_format</span><span class="o">=</span><span class="n">QueryResultFormat</span><span class="o">.</span><span class="n">REFERENCES</span><span class="p">,</span>
            <span class="n">equality_filter</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">user_name</span><span class="p">),</span>
            <span class="n">qfilter</span><span class="o">=</span><span class="n">org_filter</span><span class="p">)</span>
        <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;user </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="n">user_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;multiple users found&#39;</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_query_list_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_list_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_query_list_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_query_list</span><span class="p">()</span><span class="o">.</span><span class="n">Link</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_query_list_map</span><span class="p">[(</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span>
                                      <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_list_map</span>

<div class="viewcode-block" id="Client.get_typed_query"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Client.get_typed_query">[docs]</a>    <span class="k">def</span> <span class="nf">get_typed_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">query_type_name</span><span class="p">,</span>
                        <span class="n">query_result_format</span><span class="o">=</span><span class="n">QueryResultFormat</span><span class="o">.</span><span class="n">REFERENCES</span><span class="p">,</span>
                        <span class="n">page_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">include_links</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">qfilter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">equality_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">sort_asc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">sort_desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_TypedQuery</span><span class="p">(</span>
            <span class="n">query_type_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">query_result_format</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">include_links</span><span class="o">=</span><span class="n">include_links</span><span class="p">,</span>
            <span class="n">qfilter</span><span class="o">=</span><span class="n">qfilter</span><span class="p">,</span>
            <span class="n">equality_filter</span><span class="o">=</span><span class="n">equality_filter</span><span class="p">,</span>
            <span class="n">sort_asc</span><span class="o">=</span><span class="n">sort_asc</span><span class="p">,</span>
            <span class="n">sort_desc</span><span class="o">=</span><span class="n">sort_desc</span><span class="p">,</span></div>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_wk_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wk_type</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_wk_endpoint</span><span class="p">(</span><span class="n">wk_type</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_wk_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wk_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">wk_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_endpoints</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_endpoints</span><span class="p">[</span><span class="n">wk_type</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;The current user does not have access to the resource (</span><span class="si">%s</span><span class="s1">).&#39;</span> <span class="o">%</span></div>
                <span class="nb">str</span><span class="p">(</span><span class="n">wk_type</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


<div class="viewcode-block" id="find_link"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.find_link">[docs]</a><span class="k">def</span> <span class="nf">find_link</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">,</span> <span class="n">fail_if_absent</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the link of the specified rel and type in the resource.</span>

<span class="sd">    * @param resource the resource with the link</span>
<span class="sd">    * @param rel the rel of the desired link</span>
<span class="sd">    * @param mediaType media type of content</span>
<span class="sd">    * @param failIfAbsent controls whether an exception is thrown if there&#39;s</span>
<span class="sd">        not exactly one link of the specified rel and media type</span>
<span class="sd">    * @return the link, or null if no such link is present and failIfAbsent</span>
<span class="sd">        is false</span>
<span class="sd">    * @throws MissingLinkException if no link of the specified rel and media</span>
<span class="sd">        type is found</span>
<span class="sd">    * @throws MultipleLinksException if multiple links of the specified rel</span>
<span class="sd">        and media type are found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">links</span> <span class="o">=</span> <span class="n">get_links</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>
    <span class="n">num_links</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_links</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fail_if_absent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingLinkException</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">),</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">num_links</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span></div>
        <span class="k">raise</span> <span class="n">MultipleLinksException</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">),</span> <span class="n">rel</span><span class="p">,</span> <span class="n">media_type</span><span class="p">)</span>


<div class="viewcode-block" id="get_links"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.get_links">[docs]</a><span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="n">RelationType</span><span class="o">.</span><span class="n">DOWN</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns all the links of the specified rel and type in the resource.</span>

<span class="sd">    * @param resource the resource with the link</span>
<span class="sd">    * @param rel the rel of the desired link</span>
<span class="sd">    * @param mediaType media type of content</span>
<span class="sd">    * @return the links (could be an empty list)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">resource</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;{http://www.vmware.com/vcloud/v1.5}Link&#39;</span><span class="p">):</span>
        <span class="n">link_rel</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">)</span>
        <span class="n">link_media_type</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">link_rel</span> <span class="o">==</span> <span class="n">rel</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">media_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">link_media_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Link</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">media_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                    <span class="n">link_media_type</span> <span class="o">==</span> <span class="n">media_type</span><span class="p">:</span>
                <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Link</span><span class="p">(</span><span class="n">link</span><span class="p">))</span></div>
    <span class="k">return</span> <span class="n">links</span>


<div class="viewcode-block" id="Link"><a class="viewcode-back" href="../../../pyvcloud.vcd.html#pyvcloud.vcd.client.Link">[docs]</a><span class="k">class</span> <span class="nc">Link</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstraction over &lt;Link&gt; elements.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_elem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rel</span> <span class="o">=</span> <span class="n">link_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">link_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="n">link_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">link_elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> \</div>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">link_elem</span><span class="o">.</span><span class="n">attrib</span> <span class="k">else</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">_AbstractQuery</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">query_result_format</span><span class="p">,</span>
                 <span class="n">client</span><span class="p">,</span>
                 <span class="n">page_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_links</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">qfilter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">equality_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sort_asc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sort_desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_result_format</span> <span class="o">=</span> <span class="n">query_result_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_page_size</span> <span class="o">=</span> <span class="n">page_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_include_links</span> <span class="o">=</span> <span class="n">include_links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_page</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="o">=</span> <span class="n">qfilter</span>
        <span class="k">if</span> <span class="n">equality_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="o">+=</span> <span class="s1">&#39;;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="o">+=</span> <span class="n">equality_filter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="o">+=</span> <span class="s1">&#39;==&#39;</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="o">+=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">equality_filter</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span> <span class="o">+=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">equality_filter</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_desc</span> <span class="o">=</span> <span class="n">sort_desc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sort_asc</span> <span class="o">=</span> <span class="n">sort_asc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">query_uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_query_uri</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_query_uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_result_format</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_page</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_page_size</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filter</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_include_links</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">query_uri</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_results</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">next_page_uri</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">query_results</span><span class="o">.</span><span class="n">iterchildren</span><span class="p">():</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">QName</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">localname</span> <span class="o">==</span> <span class="s1">&#39;Link&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">RelationType</span><span class="o">.</span><span class="n">NEXT_PAGE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="n">next_page_uri</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">r</span>
            <span class="k">if</span> <span class="n">next_page_uri</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">query_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span>
                <span class="n">next_page_uri</span><span class="p">,</span> <span class="n">objectify_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience wrapper over execute().</span>

<span class="sd">        Convenience wrapper over execute() for the case where exactly one match</span>
<span class="sd">            is expected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

        <span class="c1"># Make sure we got at least one result record</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">query_results</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">query_results</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MissingRecordException</span><span class="p">()</span>

        <span class="c1"># Make sure we didn&#39;t get more than one result record</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">query_results</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">query_results</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">MultipleRecordsException</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">item</span>

    <span class="k">def</span> <span class="nf">_build_query_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">base_query_href</span><span class="p">,</span>
                         <span class="n">page</span><span class="p">,</span>
                         <span class="n">page_size</span><span class="p">,</span>
                         <span class="n">qfilter</span><span class="p">,</span>
                         <span class="n">include_links</span><span class="p">,</span>
                         <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">base_query_href</span>
        <span class="n">uri</span> <span class="o">+=</span> <span class="s1">&#39;&amp;page=&#39;</span>
        <span class="n">uri</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">page_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="s1">&#39;pageSize=&#39;</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">page_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">qfilter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># filterEncoded=true allows VCD to properly</span>
            <span class="c1"># parse encoded &#39;==&#39; in the filter parameter.</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="s1">&#39;&amp;filterEncoded=true&amp;filter=&#39;</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="n">qfilter</span>

        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="s1">&#39;&amp;fields=&#39;</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="n">fields</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_asc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="s1">&#39;&amp;sortAsc=&#39;</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_asc</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_desc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="s1">&#39;&amp;sortDesc=&#39;</span>
            <span class="n">uri</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sort_desc</span>

        <span class="k">return</span> <span class="n">uri</span>


<span class="k">class</span> <span class="nc">_TypedQuery</span><span class="p">(</span><span class="n">_AbstractQuery</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">query_type_name</span><span class="p">,</span>
                 <span class="n">client</span><span class="p">,</span>
                 <span class="n">query_result_format</span><span class="p">,</span>
                 <span class="n">page_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">include_links</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">qfilter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">equality_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sort_asc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sort_desc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_TypedQuery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">query_result_format</span><span class="p">,</span>
            <span class="n">client</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">page_size</span><span class="p">,</span>
            <span class="n">include_links</span><span class="o">=</span><span class="n">include_links</span><span class="p">,</span>
            <span class="n">qfilter</span><span class="o">=</span><span class="n">qfilter</span><span class="p">,</span>
            <span class="n">equality_filter</span><span class="o">=</span><span class="n">equality_filter</span><span class="p">,</span>
            <span class="n">sort_asc</span><span class="o">=</span><span class="n">sort_asc</span><span class="p">,</span>
            <span class="n">sort_desc</span><span class="o">=</span><span class="n">sort_desc</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_query_type_name</span> <span class="o">=</span> <span class="n">query_type_name</span>

    <span class="k">def</span> <span class="nf">_find_query_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_result_format</span><span class="p">):</span>
        <span class="p">(</span><span class="n">query_media_type</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">query_result_format</span><span class="o">.</span><span class="n">value</span>
        <span class="n">query_href</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span> \
            <span class="n">_client</span><span class="o">.</span> \
            <span class="n">_get_query_list_map</span><span class="p">()[(</span><span class="n">query_media_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_type_name</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">query_href</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, VMware.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>